<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="stylesheets/global.css">
    <link rel="stylesheet" href="stylesheets/dashboard.css">
    <title>EJS Is Super Fun</title>
  </head>

  <body>
    <div class="main">
      <div class="header">
        <h1 class="header_text">Welcome back Valete_</h1>
        <div class="header_widget">
          <a id="widget_date"></a>
          <a id="widget_temp"></a>
          <a id="widget_temp_min"></a>
          <a id="widget_temp_max"></a>
          <div>
            <img id="widget_sun_img" src="">
            <a id="widget_sun"></a>
          </div>
        </div>
      </div>

      <div class="content">
        <% for(let i=0; i<20; i++) { %>
        <div class="shortcut <%if(i%2 == 0){%>short_test<%}%>">
          <div class="shortcut_image_container">
            <% if (i%2 == 0) { %>
              <img class="shortcut_image" src="image/plex.png">
            <% } else { %>
              <img class="shortcut_image" src="image/github-mark.png">
            <% }; %>
            </div>
          <a class="shortcut_title">TEST <%= i %></a>
        </div>
        <% }; %>
      </div>
    </div>
    <div class="dashboard_settings">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M21.42,21.42h0a2,2,0,0,1-2.82,0l-7.18-7.18A6.48,6.48,0,0,1,2,9.05a7.07,7.07,0,0,1,.1-1.85A1,1,0,0,1,3.8,6.74L7,10l2.49-.5L10,7,6.74,3.8A1,1,0,0,1,7.2,2.12,7.07,7.07,0,0,1,9.05,2a6.48,6.48,0,0,1,5.19,9.4l7.18,7.18A2,2,0,0,1,21.42,21.42Z"></path>
      </svg>
    </div>
  </body>
</html>

<script>
  var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']
  document.getElementById("widget_date").innerHTML = days[new Date().getDay()]+" "+new Date().getDate()

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(async (position) => {
      const meteoreq = await fetch("https://api.open-meteo.com/v1/forecast?latitude="+position.coords.latitude+"&longitude="+position.coords.longitude+"&current=temperature_2m,precipitation,weathercode&daily=weathercode,temperature_2m_max,temperature_2m_min,sunrise,sunset,precipitation_probability_max&timezone=Europe%2FBerlin&forecast_days=1")
      const meteo = await meteoreq.json()
      document.getElementById("widget_temp").innerHTML = meteo.current.temperature_2m+" "+meteo.current_units.temperature_2m
      document.getElementById("widget_temp_min").innerHTML = "&#8681; "+meteo.daily.temperature_2m_min+" "+meteo.daily_units.temperature_2m_min
      document.getElementById("widget_temp_max").innerHTML = "&#8679; "+meteo.daily.temperature_2m_max+" "+meteo.daily_units.temperature_2m_max
      if (new Date(meteo.daily.sunrise) < new Date() && new Date(meteo.daily.sunset) > new Date()) {
        let sun = new Date(meteo.daily.sunset)
        document.getElementById("widget_sun").innerHTML = sun.getHours()+":"+sun.getMinutes()
        document.getElementById("widget_sun_img").src = "image/sunset.svg"
      } else {
        let sun = new Date(meteo.daily.sunrise)
        document.getElementById("widget_sun").innerHTML = sun.getHours()+":"+sun.getMinutes()
        document.getElementById("widget_sun_img").src = "image/sunrise.svg"
      }
    });
  } else {
    alert("error")
  }
</script>